---
name: curator

packages:
  - curator
  - python3

templates:
  bin/run: bin/run
  bin/curator_ctl: bin/curator_ctl
  config/actions.yml.erb: config/actions.yml
  config/config.yml.erb: config/config.yml
  config/purge_logs.cron: config/purge_logs.cron
  helpers/ctl_utils.sh: helpers/ctl_utils.sh
  helpers/ctl_setup.sh: helpers/ctl_setup.sh
  data/properties.sh.erb: data/properties.sh

consumes:
 - name: elasticsearch
   type: elasticsearch
   optional: true

properties:
  elasticsearch.snapshots.repository:
    description: Repository name for automatic snapshots
  elasticsearch.path_repo:
    description: |
      Shared file system to store snapshots.
      In order to register the shared file system repository it is
      necessary to mount the same shared filesystem to the same location
      on all master and data nodes.
    default: ''
  elasticsearch.cloud.aws.bucket:
    description: Bucket name on S3 where to keep snapshots
    default: ''  

  curator.elasticsearch.hosts:
    description: IP address of elasticsearch host to proxy requests for (eg, 127.0.0.1)
    default:
    - "127.0.0.1"
  curator.elasticsearch.port:
    description: Port address of elasticsearch host to proxy requests for (eg, 9200)
    default: 9200
  curator.elasticsearch.url_prefix:
    description: |
      In some cases you may be obliged to connect to your Elasticsearch cluster through 
      a proxy of some kind. There may be a URL prefix before the API URI items, 
      e.g. http://example.com/elasticsearch/ as opposed to http://localhost:9200. 
      In such a case, set the url_prefix to the appropriate value, elasticsearch in this example.
    default: ''
  curator.elasticsearch.use_ssl:
    description: If access to your Elasticsearch instance is protected by SSL encryption, you must use set use_ssl to true.
    default: 'false'  
  curator.elasticsearch.ssl_certificate:
    description: This should be a file path to your CA certificate, or left empty.
    default: ''  
  curator.elasticsearch.client_cert:
    description: This should be a file path to a client certificate (public key), or left empty.
    default: ''  
  curator.elasticsearch.client_key:
    description: This should be a file path to a client key (private key), or left empty.  
    default: '' 
  curator.elasticsearch.ssl_no_validate:
    description: |
      If access to your Elasticsearch instance is protected by 
      SSL encryption, you may set ssl_no_validate to True to 
      disable SSL certificate verification.
    default: 'false'
  curator.elasticsearch.http_auth:
    description: This setting allows basic HTTP authentication to an Elasticsearch instance (e.g. user:pass).
    default: ''  
  curator.elasticsearch.timeout:
    description: HTTP timeout for elasticsearch requests
    default: '30'  
  curator.elasticsearch.master_only:
    description: |
      In some situations, primarily with automated deployments, it makes sense to install Curator 
      on every node. But you wouldnâ€™t want it to run on each node. By setting master_only to True, this 
      is possible. It tests for, and will only continue running on the node that is the elected master.
    default: 'false'
  curator.purge_logs.unit:
    description: "One of the following values: seconds, minutes, hours, days, weeks, months, years"
    default: "days"
  curator.purge_logs.retention_period:
    description: The value of this setting will be used as a multiplier for unit
    default: 30
  curator.loglevel:
    description: Set the minimum acceptable log severity to display.
    default: INFO
  curator.cron_schedule:
    description: Schedule to trigger Curator, using normal cron format
    default: 0 0 * * *
  curator.logformat:
    description: This should default, json, logstash.
    default: default
  curator.actions:
    description: List of Elasticsearch Curator actions in YAML format.
    example: |
      - action: delete_indices
        description: >-
          Delete indices older than 45 days (based on index name), for logstash-
          prefixed indices. Ignore the error if the filter does not result in an
          actionable list of indices (ignore_empty_list) and exit cleanly.
        options:
          ignore_empty_list: True
          disable_action: True
        filters:
        - filtertype: pattern
          kind: prefix
          value: logstash-
        - filtertype: age
          source: name
          direction: older
          timestring: '%Y.%m.%d'
          unit: days
          unit_count: 45
